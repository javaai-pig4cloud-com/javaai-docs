---
title: å‘é‡åŒ–åŠå­˜å‚¨
---

## Embeddingæ¨¡å‹ç®€ä»‹

Embeddingæ¨¡å‹æ˜¯å°†æ–‡æœ¬æ•°æ®ï¼ˆå¦‚è¯æ±‡ã€çŸ­è¯­æˆ–å¥å­ï¼‰è½¬æ¢ä¸ºæ•°å€¼å‘é‡çš„å·¥å…·ï¼Œè¿™äº›å‘é‡æ•æ‰äº†æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå¯ç”¨äºå„ç§è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡ã€‚

### å·¥ä½œåŸç†
Embeddingæ¨¡å‹å°†æ–‡æœ¬æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ä¸­çš„ç‚¹ï¼Œä½¿è¯­ä¹‰ç›¸ä¼¼çš„æ–‡æœ¬åœ¨è¿™ä¸ªç©ºé—´ä¸­è·ç¦»è¾ƒè¿‘ã€‚ä¾‹å¦‚ï¼Œ"çŒ«"å’Œ"ç‹—"çš„å‘é‡å¯èƒ½ä¼šæ¯”"çŒ«"å’Œ"æ±½è½¦"çš„å‘é‡æ›´æ¥è¿‘ã€‚

### ä¼˜ç‚¹
- æ•æ‰å¤æ‚çš„è¯æ±‡å…³ç³»ï¼ˆå¦‚è¯­ä¹‰ç›¸ä¼¼æ€§ã€åŒä¹‰è¯ã€å¤šä¹‰è¯ï¼‰
- è¶…è¶Šä¼ ç»Ÿè¯è¢‹æ¨¡å‹çš„ç®€å•è®¡æ•°æ–¹å¼
- åŠ¨æ€åµŒå…¥æ¨¡å‹ï¼ˆå¦‚BERTï¼‰å¯æ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆä¸åŒçš„è¯å‘é‡

![Embeddingç¤ºæ„å›¾](https://minio.pigx.top/oss/202410/1728219277.jpg)

## LangChainæ”¯æŒçš„å‘é‡æ•°æ®åº“

LangChainæ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ï¼Œæ¯ç§æ•°æ®åº“å…·æœ‰ä¸åŒçš„ç‰¹æ€§ã€‚ä»¥ä¸‹æ˜¯éƒ¨åˆ†æ”¯æŒçš„å‘é‡æ•°æ®åº“åŠå…¶åŠŸèƒ½ï¼š

| å‘é‡å­˜å‚¨ | å­˜å‚¨å…ƒæ•°æ® | æŒ‰å…ƒæ•°æ®è¿‡æ»¤ | ç§»é™¤å‘é‡ |
| --- | --- | --- | --- |
| å†…å­˜å­˜å‚¨ | âœ… | âœ… | âœ… |
| Astra DB | âœ… |  |  |
| Azure AI Search | âœ… | âœ… | âœ… |
| Azure CosmosDB Mongo vCore | âœ… |  |  |
| Azure CosmosDB NoSQL | âœ… |  |  |
| Cassandra | âœ… |  |  |
| Chroma | âœ… | âœ… | âœ… |
| Couchbase | âœ… | âœ… |  |
| Elasticsearch | âœ… | âœ… | âœ… |
| Infinispan | âœ… |  |  |
| Milvus | âœ… | âœ… | âœ… |
| MongoDB Atlas | âœ… | ä»…æ”¯æŒåŸç”Ÿè¿‡æ»¤ |  |
| Neo4j | âœ… |  |  |
| OpenSearch | âœ… |  |  |
| Oracle | âœ… | âœ… | âœ… |
| PGVector | âœ… | âœ… | âœ… |
| Pinecone | âœ… | âœ… | âœ… |
| Qdrant | âœ… | âœ… |  |
| Redis | âœ… |  |  |
| Tablestore | âœ… | âœ… | âœ… |
| Vearch | âœ… |  |  |
| Vespa |  |  |  |
| Weaviate | âœ… | âœ… |  |

## æ–‡æœ¬å‘é‡åŒ–

ä½¿ç”¨OpenAIçš„Embeddingæ¨¡å‹è¿›è¡Œæ–‡æœ¬å‘é‡åŒ–çš„ç¤ºä¾‹ä»£ç ï¼š

```java
@Bean
public EmbeddingModel embeddingModel() {
    return OpenAiEmbeddingModel.builder()
            .apiKey(System.getenv("DASHSCOPE_KEY"))
            .modelName("text-embedding-v3")
            .baseUrl("https://dashscope.aliyuncs.com/compatible-mode/v1")
            .build();
}

Embedding queryEmbedding = embeddingModel.embed("hostæŠ¥é”™è¯·æ£€æŸ¥ç¯å¢ƒ").content();
```

## Qdrantå‘é‡åº“å­˜å‚¨

Qdrantæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å‘é‡æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨åµŒå…¥å¹¶è¿›è¡Œå¿«é€Ÿçš„å‘é‡æœç´¢ã€‚

### å®‰è£…Qdrant

ä½¿ç”¨Dockerå®‰è£…Qdrantï¼š

```bash
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant
```

- ç«¯å£6333ï¼šç”¨äºHTTP API
- ç«¯å£6334ï¼šç”¨äºgRPC API

![Qdrantè¿è¡Œæˆªå›¾](https://minio.pigx.top/oss/202410/1728373244.png)

### é›†æˆLangChain4jä¸Qdrant

1. æ·»åŠ Mavenä¾èµ–ï¼š

```xml
<dependency>
   <groupId>dev.langchain4j</groupId>
   <artifactId>langchain4j-qdrant</artifactId>
</dependency>
```

2. åˆ›å»ºQdrantå®¢æˆ·ç«¯ï¼š

```java
@Bean
public QdrantClient qdrantClient() {
    QdrantGrpcClient.Builder grpcClientBuilder = QdrantGrpcClient.newBuilder("127.0.0.1", 6334, false);
    return new QdrantClient(grpcClientBuilder.build());
}
```

3. åˆ›å»ºç´¢å¼•ï¼š

```java
var vectorParams = Collections.VectorParams.newBuilder()
        .setDistance(Collections.Distance.Cosine)
        .setSize(1024)
        .build();
qdrantClient.createCollectionAsync("testv", vectorParams);
```

4. é…ç½®Qdrant Embedding Storeï¼š

```java
@Bean
public EmbeddingStore<TextSegment> embeddingStore() {
    return QdrantEmbeddingStore.builder()
            .host("127.0.0.1")
            .port(6334)
            .collectionName("testv")
            .build();
}
```

5. æ–‡æœ¬ç”Ÿæˆä¸å­˜å‚¨ï¼š

```java
TextSegment segment1 = TextSegment.from("æµè§ˆå™¨æŠ¥é”™ 404ï¼Œè¯·æ£€æµ‹æ‚¨è¾“å…¥çš„è·¯å¾„æ˜¯å¦æ­£ç¡®");
segment1.metadata().put("author", "å†·å†·");
Embedding embedding1 = embeddingModel.embed(segment1).content();
embeddingStore.add(embedding1, segment1);
```

### å‘é‡æŸ¥è¯¢ä¸è¿‡æ»¤

1. åŸºæœ¬å‘é‡æŸ¥è¯¢ï¼š

```java
Embedding queryEmbedding = embeddingModel.embed("404 æ˜¯å“ªé‡Œçš„é—®é¢˜ï¼Ÿ").content();
EmbeddingSearchRequest embeddingSearchRequest = EmbeddingSearchRequest.builder()
        .queryEmbedding(queryEmbedding)
        .maxResults(1)
        .build();
EmbeddingSearchResult<TextSegment> searchResult = embeddingStore.search(embeddingSearchRequest);
System.out.println(searchResult.matches().get(0).embedded().text());
```

2. å¸¦å…ƒæ•°æ®è¿‡æ»¤çš„æŸ¥è¯¢ï¼š

```java
EmbeddingSearchRequest embeddingSearchRequest = EmbeddingSearchRequest.builder()
        .queryEmbedding(queryEmbedding)
        .filter(metadataKey("author").isEqualTo("å†·å†·"))
        .maxResults(1)
        .build();
```

3. å¸¸ç”¨è¿‡æ»¤å™¨ï¼š

| Filteråç§° | åŠŸèƒ½ | ä½¿ç”¨ç¤ºä¾‹ |
|-----------|------|---------|
| And | åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶ | `Filter.and(condition1, condition2)` |
| Or | æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶ | `Filter.or(condition1, condition2)` |
| Not | ä¸æ»¡è¶³æ¡ä»¶ | `Filter.not(condition)` |
| IsEqualTo | ç­‰äº | `new IsEqualTo("field", "value")` |
| IsGreaterThan | å¤§äº | `new IsGreaterThan("field", value)` |
| IsLessThan | å°äº | `new IsLessThan("field", value)` |
| IsIn | åœ¨åˆ—è¡¨å†… | `new IsIn("field", listOfValues)` |

4. è¾“å‡ºç»“æœï¼š

```java
List<EmbeddingMatch<TextSegment>> relevant = searchResult.matches();
EmbeddingMatch<TextSegment> embeddingMatch = relevant.get(0);

System.out.println(embeddingMatch.score());  // è¾“å‡ºåŒ¹é…åˆ†æ•°
System.out.println(embeddingMatch.embedded().text());  // è¾“å‡ºåŒ¹é…æ–‡æœ¬
```

## ç»“è®º

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†Embeddingæ¨¡å‹çš„æ¦‚å¿µã€LangChainæ”¯æŒçš„å‘é‡æ•°æ®åº“ã€æ–‡æœ¬å‘é‡åŒ–è¿‡ç¨‹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Qdrantå‘é‡åº“è¿›è¡Œå­˜å‚¨å’ŒæŸ¥è¯¢ã€‚é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥å¿«é€Ÿæ­å»ºåŸºäºQdrantçš„é«˜æ•ˆå‘é‡æœç´¢ç³»ç»Ÿï¼Œä¸ºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡æä¾›å¼ºå¤§çš„æ”¯æŒã€‚

<Card title="PIG AIåº”ç”¨å¼€å‘å¹³å° | é€‚åˆä¸­å¤§å‹ä¼ä¸šæ„å»ºè‡ªä¸»å¯æ§çš„AIä¸­å°" icon="link" href="https://ai.pig4cloud.com">
**ä¸ºJavaå¼€å‘è€…æä¾›å…¨æ ˆå¼AIå·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆ**ï¼Œå¼ºç±»å‹/é«˜å¯ç»´æŠ¤æ€§æ¶æ„ï¼Œå†…ç½®30+ä¸»æµå¤§æ¨¡å‹æ”¯æŒã€‚

- **ğŸ” çŸ¥è¯†å¼•æ“ä½“ç³»**ï¼šRAG çŸ¥è¯†å¼•æ“å…¨è‡ªåŠ¨åŒ–å¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆ
- **ğŸ“ AI-OCR ä¸­æ¢**ï¼šå¤æ‚éæ ‡åœºæ™¯é«˜ç²¾åº¦è¯†åˆ«
- **âš™ï¸ ä¸šåŠ¡æ™ºèƒ½èåˆ**ï¼šå‡½æ•°ç¼–æ’ + Chat2SQLï¼Œæ— ç¼å¯¹æ¥ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿ
- **ğŸ›¡ï¸ Nç»´é£æ§ä½“ç³»**ï¼šæ•æ„Ÿè¯/IP/Token/User è§„åˆ™æ§åˆ¶å¼•æ“
</Card>

<Card title="æ–‡æ¡£æœ‰è¯¯ï¼Ÿè¯·ååŠ©ç¼–è¾‘" icon="pencil" href="https://github.com/javaai-pig4cloud-com/javaai-docs/edit/main/docs/12å‘é‡åŒ–.mdx">
  å‘ç°æ–‡æ¡£é—®é¢˜ï¼Ÿç‚¹å‡»æ­¤å¤„ç›´æ¥åœ¨ GitHub ä¸Šç¼–è¾‘å¹¶æäº¤ PRï¼Œå¸®åŠ©æˆ‘ä»¬æ”¹è¿›æ–‡æ¡£ï¼
</Card>