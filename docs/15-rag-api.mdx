---
title: RAG API åŸºç¡€
---

LangChain4j æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Java åº“,æä¾›äº†ä¸°å¯Œçš„ API æ¥ç®€åŒ–æ„å»ºè‡ªå®šä¹‰ RAG(æ£€ç´¢å¢å¼ºç”Ÿæˆ)ç®¡é“çš„è¿‡ç¨‹ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç» LangChain4j çš„ä¸»è¦ç»„ä»¶å’Œ API,ä»ç®€å•åˆ°å¤æ‚çš„å¤šç§ç®¡é“å®ç°ã€‚


<img src='https://minio.pigx.top/oss/202410/1728455030.png' alt='1728455030'/>

## 2. æ ¸å¿ƒæ¦‚å¿µ

### 2.1 Document (æ–‡æ¡£)

`Document` ç±»è¡¨ç¤ºä¸€ä¸ªå®Œæ•´çš„æ–‡æ¡£,ä¾‹å¦‚å•ä¸ª PDF æ–‡ä»¶æˆ–ç½‘é¡µã€‚

#### ä¸»è¦æ–¹æ³•:
- `Document.text()`: è¿”å›æ–‡æ¡£çš„æ–‡æœ¬å†…å®¹
- `Document.metadata()`: è¿”å›æ–‡æ¡£çš„å…ƒæ•°æ®
- `Document.toTextSegment()`: å°† `Document` è½¬æ¢ä¸º `TextSegment`
- `Document.from(String, Metadata)`: ä»æ–‡æœ¬å’Œå…ƒæ•°æ®åˆ›å»º `Document`
- `Document.from(String)`: ä»æ–‡æœ¬åˆ›å»ºä¸å¸¦å…ƒæ•°æ®çš„ `Document`

### 2.2 Metadata (å…ƒæ•°æ®)

`Metadata` å­˜å‚¨æ–‡æ¡£çš„é¢å¤–ä¿¡æ¯,å¦‚åç§°ã€æ¥æºã€æœ€åæ›´æ–°æ—¶é—´ç­‰ã€‚

#### ä¸»è¦æ–¹æ³•:
- `Metadata.from(Map)`: ä» `Map` åˆ›å»º `Metadata`
- `Metadata.put(String key, String value)`: æ·»åŠ å…ƒæ•°æ®æ¡ç›®
- `Metadata.getString(String key)` / `getInteger(String key)`: è·å–æŒ‡å®šç±»å‹çš„å…ƒæ•°æ®å€¼
- `Metadata.containsKey(String key)`: æ£€æŸ¥æ˜¯å¦åŒ…å«æŒ‡å®šé”®
- `Metadata.remove(String key)`: ç§»é™¤æŒ‡å®šé”®çš„å…ƒæ•°æ®æ¡ç›®
- `Metadata.copy()`: å¤åˆ¶å…ƒæ•°æ®
- `Metadata.toMap()`: å°†å…ƒæ•°æ®è½¬æ¢ä¸º `Map`

### 2.3 TextSegment (æ–‡æœ¬ç‰‡æ®µ)

`TextSegment` è¡¨ç¤ºæ–‡æ¡£çš„ä¸€ä¸ªç‰‡æ®µ,ä¸“ç”¨äºæ–‡æœ¬ä¿¡æ¯ã€‚

#### ä¸»è¦æ–¹æ³•:
- `TextSegment.text()`: è¿”å›æ–‡æœ¬ç‰‡æ®µçš„å†…å®¹
- `TextSegment.metadata()`: è¿”å›æ–‡æœ¬ç‰‡æ®µçš„å…ƒæ•°æ®
- `TextSegment.from(String, Metadata)`: ä»æ–‡æœ¬å’Œå…ƒæ•°æ®åˆ›å»º `TextSegment`
- `TextSegment.from(String)`: ä»æ–‡æœ¬åˆ›å»ºä¸å¸¦å…ƒæ•°æ®çš„ `TextSegment`

### 2.4 Embedding (åµŒå…¥)

`Embedding` ç±»å°è£…äº†ä¸€ä¸ªæ•°å€¼å‘é‡,è¡¨ç¤ºåµŒå…¥å†…å®¹çš„è¯­ä¹‰å«ä¹‰ã€‚

#### ä¸»è¦æ–¹æ³•:
- `Embedding.dimension()`: è¿”å›åµŒå…¥å‘é‡çš„ç»´åº¦
- `CosineSimilarity.between(Embedding, Embedding)`: è®¡ç®—ä¸¤ä¸ªåµŒå…¥å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦
- `Embedding.normalize()`: å¯¹åµŒå…¥å‘é‡è¿›è¡Œå½’ä¸€åŒ–

## 3. æ–‡æ¡£å¤„ç†

### 3.1 Document Loader (æ–‡æ¡£åŠ è½½å™¨)

LangChain4j æä¾›äº†å¤šç§æ–‡æ¡£åŠ è½½å™¨:
- `FileSystemDocumentLoader`: ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ–‡æ¡£
- `UrlDocumentLoader`: ä» URL åŠ è½½æ–‡æ¡£
- `AmazonS3DocumentLoader`: ä» Amazon S3 åŠ è½½æ–‡æ¡£
- `AzureBlobStorageDocumentLoader`: ä» Azure Blob å­˜å‚¨åŠ è½½æ–‡æ¡£
- `GitHubDocumentLoader`: ä» GitHub ä»“åº“åŠ è½½æ–‡æ¡£
- `TencentCosDocumentLoader`: ä»è…¾è®¯äº‘ COS åŠ è½½æ–‡æ¡£

### 3.2 Document Parser (æ–‡æ¡£è§£æå™¨)

ç”¨äºè§£æä¸åŒæ ¼å¼çš„æ–‡æ¡£:
- `TextDocumentParser`: è§£æçº¯æ–‡æœ¬æ–‡ä»¶
- `ApachePdfBoxDocumentParser`: è§£æ PDF æ–‡ä»¶
- `ApachePoiDocumentParser`: è§£æ MS Office æ–‡ä»¶æ ¼å¼
- `ApacheTikaDocumentParser`: è‡ªåŠ¨æ£€æµ‹å¹¶è§£æå‡ ä¹æ‰€æœ‰æ–‡ä»¶æ ¼å¼

ç¤ºä¾‹:
```java
// åŠ è½½å•ä¸ªæ–‡æ¡£
Document document = FileSystemDocumentLoader.loadDocument("/path/to/file.txt", new TextDocumentParser());

// åŠ è½½ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡æ¡£
List<Document> documents = FileSystemDocumentLoader.loadDocuments("/path/to/directory", new TextDocumentParser());
```

### 3.3 Document Transformer (æ–‡æ¡£è½¬æ¢å™¨)

`DocumentTransformer` ç”¨äºå¯¹æ–‡æ¡£æ‰§è¡Œå„ç§è½¬æ¢,å¦‚æ¸…ç†ã€è¿‡æ»¤ã€å¢å¼ºæˆ–æ€»ç»“ã€‚

ç›®å‰æä¾›çš„è½¬æ¢å™¨:
- `HtmlToTextDocumentTransformer`: ä» HTML ä¸­æå–æ–‡æœ¬å†…å®¹å’Œå…ƒæ•°æ®

### 3.4 Document Splitter (æ–‡æ¡£æ‹†åˆ†å™¨)

ç”¨äºå°†æ–‡æ¡£æ‹†åˆ†æˆæ›´å°çš„ç‰‡æ®µ:
- `DocumentByParagraphSplitter`: æŒ‰æ®µè½æ‹†åˆ†
- `DocumentBySentenceSplitter`: æŒ‰å¥å­æ‹†åˆ†
- `DocumentByWordSplitter`: æŒ‰å•è¯æ‹†åˆ†
- `DocumentByCharacterSplitter`: æŒ‰å­—ç¬¦æ‹†åˆ†
- `DocumentByRegexSplitter`: æŒ‰æ­£åˆ™è¡¨è¾¾å¼æ‹†åˆ†

ä½¿ç”¨æ­¥éª¤:
1. å®ä¾‹åŒ– `DocumentSplitter` å¹¶æŒ‡å®š `TextSegment` çš„å¤§å°å’Œé‡å å­—ç¬¦æ•°
2. è°ƒç”¨ `split(Document)` æˆ– `splitAll(List<Document>)` æ–¹æ³•
3. `DocumentSplitter` å°†æ–‡æ¡£æ‹†åˆ†æˆå°ç‰‡æ®µ,å¹¶ç»„åˆä¸º `TextSegment`

## 4. åµŒå…¥å¤„ç†

### 4.1 Embedding Model (åµŒå…¥æ¨¡å‹)

`EmbeddingModel` æ¥å£è¡¨ç¤ºä¸€ç§å°†æ–‡æœ¬è½¬æ¢ä¸º `Embedding` çš„æ¨¡å‹ã€‚

#### ä¸»è¦æ–¹æ³•:
- `EmbeddingModel.embed(String)`: åµŒå…¥æŒ‡å®šæ–‡æœ¬
- `EmbeddingModel.embed(TextSegment)`: åµŒå…¥æŒ‡å®š `TextSegment`
- `EmbeddingModel.embedAll(List<TextSegment>)`: åµŒå…¥å¤šä¸ª `TextSegment`
- `EmbeddingModel.dimension()`: è¿”å›åµŒå…¥å‘é‡çš„ç»´åº¦

### 4.2 Embedding Store (åµŒå…¥å­˜å‚¨)

`EmbeddingStore` æ¥å£è¡¨ç¤ºä¸€ä¸ªåµŒå…¥å­˜å‚¨åº“(å‘é‡æ•°æ®åº“),ç”¨äºå­˜å‚¨å’Œé«˜æ•ˆæœç´¢ç›¸ä¼¼çš„åµŒå…¥ã€‚

#### ä¸»è¦æ–¹æ³•:
- `EmbeddingStore.add(Embedding)`: æ·»åŠ åµŒå…¥å¹¶è¿”å›éšæœº ID
- `EmbeddingStore.addAll(List<Embedding>)`: æ·»åŠ å¤šä¸ªåµŒå…¥å¹¶è¿”å›éšæœº ID åˆ—è¡¨
- `EmbeddingStore.search(EmbeddingSearchRequest)`: æœç´¢æœ€ç›¸ä¼¼çš„åµŒå…¥
- `EmbeddingStore.remove(String id)`: åˆ é™¤æŒ‡å®š ID çš„åµŒå…¥

### 4.3 Embedding Store Ingestor (åµŒå…¥å­˜å‚¨æ‘„å–å™¨)

`EmbeddingStoreIngestor` è´Ÿè´£å°†æ–‡æ¡£åµŒå…¥å¹¶å­˜å‚¨åˆ° `EmbeddingStore` ä¸­ã€‚

ç¤ºä¾‹:
```java
EmbeddingStoreIngestor ingestor = EmbeddingStoreIngestor.builder()
    .embeddingModel(embeddingModel)
    .embeddingStore(embeddingStore)
    .build();

ingestor.ingest(document1);
```

å¯ä»¥é€šè¿‡æŒ‡å®š `DocumentTransformer` å’Œ `DocumentSplitter`,åœ¨åµŒå…¥å‰å¯¹æ–‡æ¡£è¿›è¡Œè½¬æ¢å’Œæ‹†åˆ†ã€‚

## 5. æ„å»º RAG ç®¡é“

ä½¿ç”¨ LangChain4j æ„å»º RAG ç®¡é“çš„ä¸€èˆ¬æ­¥éª¤:

1. åŠ è½½æ–‡æ¡£: ä½¿ç”¨é€‚å½“çš„ `DocumentLoader` å’Œ `DocumentParser` åŠ è½½æ–‡æ¡£
2. è½¬æ¢æ–‡æ¡£: ä½¿ç”¨ `DocumentTransformer` æ¸…ç†æˆ–å¢å¼ºæ–‡æ¡£(å¯é€‰)
3. æ‹†åˆ†æ–‡æ¡£: ä½¿ç”¨ `DocumentSplitter` å°†æ–‡æ¡£æ‹†åˆ†ä¸ºæ›´å°çš„ç‰‡æ®µ
4. åµŒå…¥æ–‡æ¡£: ä½¿ç”¨ `EmbeddingModel` å°†æ–‡æ¡£ç‰‡æ®µè½¬æ¢ä¸ºåµŒå…¥å‘é‡
5. å­˜å‚¨åµŒå…¥: ä½¿ç”¨ `EmbeddingStore` å­˜å‚¨åµŒå…¥å‘é‡
6. æ£€ç´¢ç›¸å…³å†…å®¹: æ ¹æ®ç”¨æˆ·æŸ¥è¯¢,ä» `EmbeddingStore` æ£€ç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ
7. ç”Ÿæˆå“åº”: å°†æ£€ç´¢åˆ°çš„ç›¸å…³å†…å®¹ä¸ç”¨æˆ·æŸ¥è¯¢ä¸€èµ·æä¾›ç»™è¯­è¨€æ¨¡å‹,ç”Ÿæˆæœ€ç»ˆå“åº”

## 6. æœ€ä½³å®è·µ

- æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–‡æ¡£æ‹†åˆ†ç­–ç•¥
- ä½¿ç”¨è‡ªå®šä¹‰çš„ `DocumentTransformer` æ¥æ¸…ç†å’Œå¢å¼ºæ–‡æ¡£
- é€‰æ‹©åˆé€‚çš„åµŒå…¥æ¨¡å‹å’ŒåµŒå…¥å­˜å‚¨ä»¥å¹³è¡¡æ€§èƒ½å’Œå‡†ç¡®æ€§
- å®šæœŸæ›´æ–°å’Œç»´æŠ¤åµŒå…¥å­˜å‚¨,ä»¥ç¡®ä¿ä¿¡æ¯çš„æ—¶æ•ˆæ€§
- å¯¹æ£€ç´¢ç»“æœè¿›è¡Œåå¤„ç†,å¦‚é‡æ–°æ’åºæˆ–è¿‡æ»¤,ä»¥æé«˜ç›¸å…³æ€§

## 7. ç»“è¯­

LangChain4j æä¾›äº†æ„å»ºé«˜æ•ˆ RAG ç³»ç»Ÿæ‰€éœ€çš„å…¨å¥—å·¥å…·ã€‚é€šè¿‡çµæ´»ç»„åˆè¿™äº›ç»„ä»¶,æ‚¨å¯ä»¥åˆ›å»ºé€‚åˆç‰¹å®šç”¨ä¾‹çš„è‡ªå®šä¹‰ RAG ç®¡é“ã€‚éšç€é¡¹ç›®çš„å‘å±•,ä¸æ–­ä¼˜åŒ–å’Œè°ƒæ•´å„ä¸ªç»„ä»¶,ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å’Œå‡†ç¡®æ€§ã€‚

<Card title="PIG AIåº”ç”¨å¼€å‘å¹³å° | é€‚åˆä¸­å¤§å‹ä¼ä¸šæ„å»ºè‡ªä¸»å¯æ§çš„AIä¸­å°" icon="link" href="https://ai.pig4cloud.com">
**ä¸ºJavaå¼€å‘è€…æä¾›å…¨æ ˆå¼AIå·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆ**ï¼Œå¼ºç±»å‹/é«˜å¯ç»´æŠ¤æ€§æ¶æ„ï¼Œå†…ç½®30+ä¸»æµå¤§æ¨¡å‹æ”¯æŒã€‚

- **ğŸ” çŸ¥è¯†å¼•æ“ä½“ç³»**ï¼šRAG çŸ¥è¯†å¼•æ“å…¨è‡ªåŠ¨åŒ–å¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆ
- **ğŸ“ AI-OCR ä¸­æ¢**ï¼šå¤æ‚éæ ‡åœºæ™¯é«˜ç²¾åº¦è¯†åˆ«
- **âš™ï¸ ä¸šåŠ¡æ™ºèƒ½èåˆ**ï¼šå‡½æ•°ç¼–æ’ + Chat2SQLï¼Œæ— ç¼å¯¹æ¥ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿ
- **ğŸ›¡ï¸ Nç»´é£æ§ä½“ç³»**ï¼šæ•æ„Ÿè¯/IP/Token/User è§„åˆ™æ§åˆ¶å¼•æ“
</Card>

<Card title="æ–‡æ¡£æœ‰è¯¯ï¼Ÿè¯·ååŠ©ç¼–è¾‘" icon="pencil" href="https://github.com/javaai-pig4cloud-com/javaai-docs/edit/main/docs/15RAG API.mdx">
  å‘ç°æ–‡æ¡£é—®é¢˜ï¼Ÿç‚¹å‡»æ­¤å¤„ç›´æ¥åœ¨ GitHub ä¸Šç¼–è¾‘å¹¶æäº¤ PRï¼Œå¸®åŠ©æˆ‘ä»¬æ”¹è¿›æ–‡æ¡£ï¼
</Card>