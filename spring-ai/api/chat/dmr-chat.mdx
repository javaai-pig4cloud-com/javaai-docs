---
title: "Docker Model Runner Chat"
---

[Docker Model Runner](https://docs.docker.com/desktop/features/model-runner/) is an AI Inference Engine offering a wide range of models from [various providers](https://hub.docker.com/u/ai).

Spring AI integrates with the Docker Model Runner by reusing the existing [OpenAI](/spring4ai/api/chat/openai-chat) backed `ChatClient`. To do this, set the base URL to `http://localhost:12434/engines` and select one of the provided [LLM models](https://hub.docker.com/u/ai).


Check the [DockerModelRunnerWithOpenAiChatModelIT.java](https://github.com/spring-projects/spring-ai/blob/main/models/spring-ai-openai/src/test/java/org/springframework/ai/openai/chat/proxy/DockerModelRunnerWithOpenAiChatModelIT.java) tests for examples of how to use the Docker Model Runner with Spring AI.

## Prerequisites

* Download Docker Desktop for Mac 4.40.0.

Choose one of the following options to enable the Model Runner:

### Option 1: Direct Connection

* Enable Model Runner: `docker desktop enable model-runner --tcp 12434`
* Set the base-url to `http://localhost:12434/engines`

### Option 2: Using Testcontainers

* Enable Model Runner: `docker desktop enable model-runner`
* Use Testcontainers and set the base-url as follows:

```java
@Container
private static final SocatContainer socat = new SocatContainer()
    .withTarget(80, "model-runner.docker.internal");

@Bean
public OpenAiApi chatCompletionApi() {
    var baseUrl = "http://%s:%d/engines".formatted(socat.getHost(), socat.getMappedPort(80));
    return OpenAiApi.builder().baseUrl(baseUrl).apiKey("test").build();
}
```

<Tip>
You can learn more about the Docker Model Runner by reading the [Run LLMs Locally with Docker](https://www.docker.com/blog/run-llms-locally/) blog post.
</Tip>

## Auto-configuration

<Note>
The artifact IDs for Spring AI starter modules have been renamed since version 1.0.0.M7. Dependency names should now follow updated naming patterns for models, vector stores, and MCP starters.
Please refer to the [upgrade notes](https://docs.spring.io/spring-ai/reference/upgrade-notes.html) for more information.
</Note>

Spring AI provides Spring Boot auto-configuration for the OpenAI Chat Client.
To enable it, add the following dependency to your project's build file:

<Tabs>
  <Tab title="Maven">
    ```xml
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-model-openai</artifactId>
    </dependency>
    ```
  </Tab>
  <Tab title="Gradle">
    ```gradle
    dependencies {
        implementation 'org.springframework.ai:spring-ai-starter-model-openai'
    }
    ```
  </Tab>
</Tabs>

<Tip>
Refer to the [Dependency Management](/spring4ai/getting-started#dependency-management) section to add the Spring AI BOM to your build file.
</Tip>

### Chat Properties

#### Retry Properties

The prefix `spring.ai.retry` is used as the property prefix that lets you configure the retry mechanism for the OpenAI chat model.

| Property | Description | Default |
| :------- | :---------- | :------ |
| spring.ai.retry.max-attempts | Maximum number of retry attempts. | 10 |
| spring.ai.retry.backoff.initial-interval | Initial sleep duration for the exponential backoff policy. | 2 sec. |
| spring.ai.retry.backoff.multiplier | Backoff interval multiplier. | 5 |
| spring.ai.retry.backoff.max-interval | Maximum backoff duration. | 3 min. |
| spring.ai.retry.on-client-errors | If false, throw a NonTransientAiException, and do not attempt retry for `4xx` client error codes | false |
| spring.ai.retry.exclude-on-http-codes | List of HTTP status codes that should not trigger a retry (e.g. to throw NonTransientAiException). | empty |
| spring.ai.retry.on-http-codes | List of HTTP status codes that should trigger a retry (e.g. to throw TransientAiException). | empty |

#### Connection Properties

The prefix `spring.ai.openai` is used as the property prefix that lets you connect to OpenAI.

| Property | Description | Default |
| :------- | :---------- | :------ |
| spring.ai.openai.base-url | The URL to connect to. Must be set to `https://hub.docker.com/u/ai` | - |
| spring.ai.openai.api-key | Any string | - |

#### Configuration Properties

<Note>
Enabling and disabling chat auto-configurations is now done via top level properties with the prefix `spring.ai.model.chat`.

To enable, `spring.ai.model.chat=openai` (It is enabled by default)

To disable, `spring.ai.model.chat=none` (or any value which doesn't match openai)

This change allows for the configuration of multiple models in your application.
</Note>

The prefix `spring.ai.openai.chat` is the property prefix that lets you configure the chat model implementation for OpenAI.

| Property | Description | Default |
| :------- | :---------- | :------ |
| spring.ai.model.chat | Enable OpenAI chat model. | openai |
| spring.ai.openai.chat.base-url | Optional overrides the `spring.ai.openai.base-url` to provide a chat specific url. Must be set to `http://localhost:12434/engines` | - |
| spring.ai.openai.chat.api-key | Optional overrides the spring.ai.openai.api-key to provide chat specific api-key | - |
| spring.ai.openai.chat.options.model | The [LLM model](https://hub.docker.com/u/ai) to use | - |
| spring.ai.openai.chat.options.temperature | The sampling temperature that controls the apparent creativity of generated completions. Higher values will make output more random while lower values will make results more focused and deterministic. | 0.8 |
| spring.ai.openai.chat.options.frequencyPenalty | Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far. | 0.0f |
| spring.ai.openai.chat.options.maxTokens | The maximum number of tokens to generate in the chat completion. | - |
| spring.ai.openai.chat.options.n | How many chat completion choices to generate for each input message. | 1 |
| spring.ai.openai.chat.options.presencePenalty | Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far. | - |
| spring.ai.openai.chat.options.responseFormat | An object specifying the format that the model must output. Setting to `{ "type": "json_object" }` enables JSON mode. | - |
| spring.ai.openai.chat.options.seed | This feature is in Beta. If specified, our system will make a best effort to sample deterministically. | - |
| spring.ai.openai.chat.options.stop | Up to 4 sequences where the API will stop generating further tokens. | - |
| spring.ai.openai.chat.options.topP | An alternative to sampling with temperature, called nucleus sampling. | - |
| spring.ai.openai.chat.options.tools | A list of tools the model may call. Currently, only functions are supported as a tool. | - |
| spring.ai.openai.chat.options.toolChoice | Controls which (if any) function is called by the model. | - |
| spring.ai.openai.chat.options.user | A unique identifier representing your end-user. | - |
| spring.ai.openai.chat.options.functions | List of functions, identified by their names, to enable for function calling. | - |
| spring.ai.openai.chat.options.stream-usage | (For streaming only) Set to add an additional chunk with token usage statistics. | false |
| spring.ai.openai.chat.options.proxy-tool-calls | If true, Spring AI will not handle function calls internally, but will proxy them to the client. | false |

<Tip>
All properties prefixed with `spring.ai.openai.chat.options` can be overridden at runtime by adding a request specific Runtime Options to the `Prompt` call.
</Tip>

## Runtime Options

The [OpenAiChatOptions.java](https://github.com/spring-projects/spring-ai/blob/main/models/spring-ai-openai/src/main/java/org/springframework/ai/openai/OpenAiChatOptions.java) provides model configurations, such as the model to use, the temperature, the frequency penalty, etc.

On start-up, the default options can be configured with the `OpenAiChatModel(api, options)` constructor or the `spring.ai.openai.chat.options.*` properties.

At run-time you can override the default options by adding new, request specific, options to the `Prompt` call.
For example, to override the default model and temperature for a specific request:

```java
ChatResponse response = chatModel.call(
    new Prompt(
        "Generate the names of 5 famous pirates.",
        OpenAiChatOptions.builder()
            .model("ai/gemma3:4B-F16")
        .build()
    ));
```

<Tip>
In addition to the model specific [OpenAiChatOptions](https://github.com/spring-projects/spring-ai/blob/main/models/spring-ai-openai/src/main/java/org/springframework/ai/openai/OpenAiChatOptions.java) you can use a portable [ChatOptions](https://github.com/spring-projects/spring-ai/blob/main/spring-ai-client-chat/src/main/java/org/springframework/ai/chat/prompt/ChatOptions.java) instance, created with the [ChatOptions#builder()](https://github.com/spring-projects/spring-ai/blob/main/spring-ai-client-chat/src/main/java/org/springframework/ai/chat/prompt/ChatOptions.java).
</Tip>

## Function Calling

Docker Model Runner supports Tool/Function calling when selecting a model that supports it.

You can register custom Java functions with your ChatModel and have the provided model intelligently choose to output a JSON object containing arguments to call one or many of the registered functions.
This is a powerful technique for connecting the LLM capabilities with external tools and APIs.

### Tool Example

Here's a simple example of how to use Docker Model Runner function calling with Spring AI:

```properties
spring.ai.openai.api-key=test
spring.ai.openai.base-url=http://localhost:12434/engines
spring.ai.openai.chat.options.model=ai/gemma3:4B-F16
```

```java
@SpringBootApplication
public class DockerModelRunnerLlmApplication {

    public static void main(String[] args) {
        SpringApplication.run(DockerModelRunnerLlmApplication.class, args);
    }

    @Bean
    CommandLineRunner runner(ChatClient.Builder chatClientBuilder) {
        return args -> {
            var chatClient = chatClientBuilder.build();

            var response = chatClient.prompt()
                .user("What is the weather in Amsterdam and Paris?")
                .functions("weatherFunction") // reference by bean name.
                .call()
                .content();

            System.out.println(response);
        };
    }

    @Bean
    @Description("Get the weather in location")
    public Function<WeatherRequest, WeatherResponse> weatherFunction() {
        return new MockWeatherService();
    }

    public static class MockWeatherService implements Function<WeatherRequest, WeatherResponse> {

        public record WeatherRequest(String location, String unit) {}
        public record WeatherResponse(double temp, String unit) {}

        @Override
        public WeatherResponse apply(WeatherRequest request) {
            double temperature = request.location().contains("Amsterdam") ? 20 : 25;
            return new WeatherResponse(temperature, request.unit);
        }
    }
}
```

In this example, when the model needs weather information, it will automatically call the `weatherFunction` bean, which can then fetch real-time weather data.
The expected response is: "The weather in Amsterdam is currently 20 degrees Celsius, and the weather in Paris is currently 25 degrees Celsius."

<Tip>
Read more about OpenAI [Function Calling](/spring4ai/api/chat/functions/openai-chat-functions).
</Tip>

## Sample Controller

[Create](https://start.spring.io/) a new Spring Boot project and add the `spring-ai-starter-model-openai` to your pom (or gradle) dependencies.

Add a `application.properties` file, under the `src/main/resources` directory, to enable and configure the OpenAi chat model:

```properties
spring.ai.openai.api-key=test
spring.ai.openai.base-url=http://localhost:12434/engines
spring.ai.openai.chat.options.model=ai/gemma3:4B-F16

# Docker Model Runner doesn't support embeddings, so we need to disable them.
spring.ai.openai.embedding.enabled=false
``` 